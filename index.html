<!DOCTYPE html>
<html>
  <head>
    <title>Webchat</title>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <body>
      <ul id="name"></ul>
      <form id="greeting">
        <input id="nicknameInput" data-testid="nickname-box" autocomplete="off" /><button data-testid="nickname-save">Change</button>
      </form>
      <ul id="messages"></ul>
      <form id="form" action="">
        <input id="messageInput" data-testid="message-box" autocomplete="off" /><button data-testid="send-button">Send</button>
      </form>
    </body>
    <script>
      $(function () {
        const socket = io();

        $('#form').submit(function(e) {
          e.preventDefault();
          socket.emit('message', $('#messageInput').val());
          $('#messageInput').val('');
          return false;
        });

        $('#greeting').submit(function(e) {
          e.preventDefault();
          socket.emit('changeNickname', $('#nicknameInput').val());
          $('#nicknameInput').val('');
          return false;
        });

        socket.on('messageServer', function(fullMessage){
          $('#messages').append($('<li>').text(fullMessage).attr("data-testid", "message"));
        });

        socket.on('nicknameServer', function(nickname){
          $('#name').append($('<li>').text(`Hi, ${nickname}`).attr("data-testid", "nicknameText"));
        });
     });
    </script>
  </head>
</html>
